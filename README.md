# hive

蜂巢识别项目

## TODO
- [x] 在中心图片中心加入一个“+”形状的准星
- [x] 优化边缘检测算法，能够更加准确匹配幼虫的外接圆
- [x] YOLO5检测精度优化，能够识别身边没有蜂蜡的蜜蜂幼虫
- [x] 修复外接圆绘制不完整的问题
- [x] 动态调整输出图片的文字标签字体大小
- [x] 转换RKNN并成功在RK3399pro上进行检测
- [x] 优化程序逻辑，读取一帧图片识别一张图片
- [x] 测试一帧图像处理平均速率
- [x] 六边形检测优化，准确识别中点下方两个六边形方框
- [x] 使用python进行GPIO调用
- [x] 使用双路摄像头同时检测
- [x] 将参数暴露出来，做成配置文件
- [x] 需要能够进行偏移、旋转
- [x] 校准模式和识别模式，可以进行切换

## 使用方式
### 1 配置环境
这里建议只需要安装rknn-toolkit-lite 1.7.1就好  
然后再安装matplotlib和python-periphery(用于调用GPIO)  

### 2 配置参数
打开`config.json`文件，请根据需求进行修改：  
```json
{
    "multipleCamera": true,     //是否开启双摄像头，true表示多摄像头，false表示单摄像头
    "diameterThreshold": 0.7,   //检测幼虫的直径阈值，小于这个阈值不会向机械臂发送信号，单位是mm
    "sleepTime": 1.0,           //向机械臂发送信号后，等待响应的时长
    "dojiOffset": 1.0,          //红色准星偏离蓝色准星的最大距离，单位是mm
    "resolution": [1920, 1080], //最终显示的分辨率，可以设置的分辨率：最小[640, 360]，最大[2592, 1944]，默认[1920, 1080]

    "preProcess": false,        //是否进行预处理，以下3项是预处理的参数，true是做预处理，false是不做预处理
    "topOffset": 0.0,           //预处理（上下偏移）：正数向下偏移，负数向上偏移
    "leftOffset": 0.0,          //预处理（左右偏移）：正数向右偏移，负数向左偏移
    "rotate": 0.0,              //预处理（绕中点旋转）

    // 上面的是可配置参数，下面的不做修改。
    "outputRoot": "./camera_output",
    "problemRoot": "./problem",
    "gpioPin": [[3, 5, 7], [11, 13, 15], [19, 21, 23]],
    "gpioMap": {
        "3": 73,
        "5": 74,
        "7": 89,
        "11": 83,
        "13": 85,
        "15": 84,
        "19": 40,
        "21": 39,
        "23": 41
    }
}
```

### 3 运行程序
```shell
sudo python3 main.py
```

或者双击脚本`start.sh`运行  
